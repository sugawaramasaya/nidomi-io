# 🔄 デザインリファクタリング実行ガイド

## 📋 リファクタリング前の準備チェックリスト

### 1. 現状把握
- [ ] 現在のコンポーネント/画面のスクリーンショット取得
- [ ] 関連するFigmaデザインファイルのリンク確認
- [ ] 影響を受ける可能性のある他のコンポーネント/画面をリスト化
- [ ] 使用中のトークン（色・サイズ・余白）を確認

### 2. 変更内容の明確化
- [ ] 変更前後のFigmaデザインを並べて比較
- [ ] 変更箇所を具体的にリスト化（色/サイズ/余白/レイアウト）
- [ ] 変更しない箇所を明確に定義
- [ ] 新しく必要なトークンがあるか確認

### 3. 実装計画
- [ ] リファクタリングの順序を決定
- [ ] 各段階の完了条件を定義
- [ ] ロールバック手順を準備

---

## 🎯 段階別リファクタリング手順

### Phase 1: 構造の変更（Layout Refactoring）

#### 実行前の指示例
```
以下の条件でレイアウト構造のみを変更してください：

【対象】: components/Button.tsx
【変更内容】: flexboxからgridレイアウトに変更
【参照デザイン】: [Figmaリンク]
【変更しない要素】: 色、フォントサイズ、余白は現状維持
【確認方法】: 見た目は変えずにHTML構造のみ変更

実装後に変更前後のスクリーンショットを確認します。
```

#### 完了確認
- [ ] HTML構造が意図通りに変更されている
- [ ] 見た目に変化がない（色・サイズ・余白は同一）
- [ ] 他のコンポーネントに影響していない

### Phase 2: トークン・変数の更新（Token Refactoring）

#### 実行前の指示例
```
以下の条件でカラートークンのみを更新してください：

【対象】: components/Button.tsx
【変更内容】: 
  - --primary-blue → --nidomi-blue-70 に変更
  - --text-dark → --on-surface に変更
【参照デザイン】: [Figmaリンク]
【変更しない要素】: レイアウト、サイズ、余白は現状維持
【使用トークン】: globals.cssに定義済みのもののみ使用

実装後にカラーの変更のみが反映されていることを確認します。
```

#### 完了確認
- [ ] 指定したカラートークンのみが変更されている
- [ ] レイアウト・サイズに変化がない
- [ ] 新しいカラーがデザインと一致している

### Phase 3: サイズ・余白の調整（Spacing Refactoring）

#### 実行前の指示例
```
以下の条件でスペーシングのみを調整してください：

【対象】: components/Button.tsx
【変更内容】: 
  - padding: --space-16 → --space-24 に変更
  - margin: --space-8 → --space-12 に変更
【参照デザイン】: [Figmaリンク]
【変更しない要素】: 色、レイアウト構造は現状維持
【使用トークン】: globals.cssのspace系トークンのみ使用

実装後にスペーシングの変更のみが反映されていることを確認します。
```

#### 完了確認
- [ ] 指定したスペーシングのみが変更されている
- [ ] 色・レイアウト構造に変化がない
- [ ] 新しいスペーシングがデザインと一致している

### Phase 4: 全体統合確認（Integration Check）

#### 実行前の指示例
```
全ての変更が完了後、以下を確認してください：

【確認項目】:
1. Figmaデザインとの完全一致確認
2. 他のコンポーネントとの整合性確認
3. レスポンシブ表示の確認
4. 使用していないCSSクラスの削除

【使用禁止】: 
- 任意の値（arbitrary values）
- カスタムCSS
- globals.cssに未定義のトークン

最終的な実装がDESIGN_GUIDELINE.mdに完全準拠していることを確認します。
```

#### 完了確認
- [ ] Figmaデザインと1px単位で一致している
- [ ] DESIGN_GUIDELINE.mdのルールに準拠している
- [ ] 不要なCSSクラスが削除されている
- [ ] レスポンシブ表示が正常に動作している

---

## 🚨 リファクタリング中の注意事項

### AIに対する明確な制約
1. **一度に複数の変更を行わない**
   - 色とサイズを同時に変更しない
   - レイアウトとスペーシングを同時に変更しない

2. **変更範囲を厳密に制限**
   - 指定されていない要素は絶対に変更しない
   - 推測による調整は一切禁止

3. **各段階での確認を必須化**
   - 実装後は必ずスクリーンショットで確認
   - 意図しない変更があれば即座に修正

### エラー対応
1. **意図しない変更を発見した場合**
   ```
   以下の変更は意図していません。直前の状態に戻してください：
   - [具体的な間違い]
   - [正しい状態の説明]
   ```

2. **デザインとの不一致を発見した場合**
   ```
   Figmaデザインと一致していません。以下を修正してください：
   - [不一致の箇所]
   - [正しい値や状態]
   ```

---

## 📊 リファクタリング進捗管理

### チェックリストテンプレート
```
## [コンポーネント名] リファクタリング進捗

### Phase 1: 構造変更
- [ ] 実装完了
- [ ] スクリーンショット確認
- [ ] 他コンポーネントへの影響確認

### Phase 2: トークン更新
- [ ] 実装完了
- [ ] カラー確認
- [ ] デザイン一致確認

### Phase 3: スペーシング調整
- [ ] 実装完了
- [ ] サイズ確認
- [ ] レスポンシブ確認

### Phase 4: 統合確認
- [ ] 最終実装確認
- [ ] ガイドライン準拠確認
- [ ] 動作テスト完了

### 完了条件
- [ ] Figmaデザインとの完全一致
- [ ] 他のコンポーネントとの整合性
- [ ] ガイドライン準拠
```

---

## 🎯 成功のためのコツ

### 1. 詳細すぎるほどの指示
AIには曖昧さを排除した超具体的な指示を出す

### 2. 小さな変更の積み重ね
大きな変更は必ず小さな変更に分割する

### 3. 各段階での厳密な確認
妥協せずに1px単位での精度を要求する

### 4. ロールバック体制の整備
いつでも前の状態に戻せる準備をしておく

### 5. デザインシステムとの整合性維持
既存のトークンとコンポーネントとの一貫性を保つ

---

このガイドに従って段階的に進めることで、AIとの協働でも正確なデザインリファクタリングが可能になります。
